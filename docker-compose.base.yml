services:
  web:
    env_file:
      - ".env"
    environment:
      - DB_NAME=${DB_NAME:-master}
      - DB_PASSWORD=${DB_PASSWORD:-__default}
      - DB_USER=postgres
      - DB_HOST=db
      - DB_PORT=5432
    ports:
      - "${PORT:-80}:${PORT:-3000}"
<<<<<<< HEAD
    labels:
      - com.centurylinklabs.watchtower.enable="true"
=======
>>>>>>> main
    depends_on:
      db:
        condition: service_healthy

  db:
    image: postgres:latest
    environment:
      - POSTGRES_DB=${DB_NAME:-master}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-__default}
      - POSTGRES_USER=${DB_USER:-postgres}
      - PGDATA=/data/pgdata
    volumes:
      - postgres_data:/data/pgdata
    healthcheck:
      interval: 5s
      timeout: 10s
      retries: 10
      test: pg_isready -h localhost -U $$POSTGRES_USER

<<<<<<< HEAD
  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command:
      - --label-enable

=======
>>>>>>> main
volumes:
  postgres_data: